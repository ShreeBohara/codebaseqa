# ===========================================
# CodebaseQA Environment Configuration
# ===========================================
# Copy this file to .env and fill in your values
# Never commit .env to version control!

# -----------------------
# LLM Providers (at least one required)
# -----------------------
OPENAI_API_KEY=sk
# ANTHROPIC_API_KEY=sk-ant-...

# For local LLM (optional, no key needed)
# OLLAMA_BASE_URL=http://localhost:11434

# -----------------------
# Embedding Providers
# -----------------------
# Uses OpenAI by default. Uncomment to use alternatives:
# EMBEDDING_PROVIDER=openai  # openai, voyage, or local
# OPENAI_EMBEDDING_MAX_TOKENS_PER_REQUEST=250000
# OPENAI_EMBEDDING_MAX_TEXTS_PER_REQUEST=128
# OPENAI_EMBEDDING_REQUEST_CONCURRENCY=1
# OPENAI_EMBEDDING_MIN_SECONDS_BETWEEN_REQUESTS=0.0
# OPENAI_EMBEDDING_RATE_LIMIT_MAX_RETRIES=6
# OPENAI_EMBEDDING_RATE_LIMIT_BASE_BACKOFF_SECONDS=1.0
# OPENAI_EMBEDDING_RATE_LIMIT_MAX_BACKOFF_SECONDS=30.0
# VOYAGE_API_KEY=pa-...
# USE_LOCAL_EMBEDDINGS=true

# -----------------------
# GitHub (optional, for private repos)
# -----------------------
# GITHUB_TOKEN=ghp_...

# -----------------------
# Database
# -----------------------
# Defaults to SQLite. Uncomment for PostgreSQL:
DATABASE_URL=sqlite:///./data/codebaseqa.db
# DATABASE_URL=postgresql://user:pass@localhost:5432/codebaseqa

# -----------------------
# Vector Database
# -----------------------
VECTOR_DB_TYPE=chroma
# VECTOR_DB_TYPE=qdrant
# QDRANT_URL=http://localhost:6333

# Optional Redis (recommended for distributed cache/rate-limits)
# REDIS_URL=redis://localhost:6379/0

# -----------------------
# Application Settings
# -----------------------
DEBUG=false
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# -----------------------
# Live Demo Mode (optional)
# -----------------------
DEMO_MODE=false
SEED_DEMO=false
DEMO_REPO_URL=https://github.com/vercel/nextjs-subscription-payments
DEMO_REPO_OWNER=vercel
DEMO_REPO_NAME=nextjs-subscription-payments
DEMO_REPO_BRANCH=main
DEMO_ALLOW_PUBLIC_IMPORTS=false
DEMO_BANNER_TEXT=Live demo mode: this deployment is pinned to one featured repository. For your own repository, self-host with your API key.
DEMO_BUSY_MODE=false

# Soft guardrails for public demo traffic
DEMO_RATE_LIMIT_ENABLED=true
DEMO_RATE_LIMIT_COOLDOWN_SECONDS=30
DEMO_CHAT_REQUESTS=18
DEMO_CHAT_WINDOW_SECONDS=60
DEMO_CURRICULUM_REQUESTS=6
DEMO_CURRICULUM_WINDOW_SECONDS=60
DEMO_LESSON_REQUESTS=8
DEMO_LESSON_WINDOW_SECONDS=60
DEMO_GRAPH_REQUESTS=5
DEMO_GRAPH_WINDOW_SECONDS=60
DEMO_CHALLENGE_REQUESTS=10
DEMO_CHALLENGE_WINDOW_SECONDS=60

# Graph V2 settings
# GRAPH_V2_ENABLED=true
# GRAPH_V2_MAX_NODES=160
# GRAPH_V2_MAX_EDGES=600
# GRAPH_V2_ENRICH_DESCRIPTIONS=false
# GRAPH_DENSE_MODE_V21=true
# GRAPH_V21_AUTO_NODES_THRESHOLD=90
# GRAPH_V21_AUTO_EDGES_THRESHOLD=240
# GRAPH_V21_SCOPE_MAX_NODES=220
# GRAPH_V21_SCOPE_MAX_EDGES=420
# GRAPH_V21_MODULE_MAX_NODES=120
# GRAPH_V21_MODULE_MAX_EDGES=260
# GRAPH_V21_CACHE_TTL_SECONDS=45
# GRAPH_V21_CACHE_MAX_ENTRIES=64
# GRAPH_V21_EDGE_BUDGET_FILE_PER_NODE=10
# GRAPH_V21_EDGE_BUDGET_MODULE_PER_NODE=14
# GRAPH_V22_MIN_CROSS_MODULE_RATIO_FOR_OVERVIEW=0.08
# GRAPH_V22_MIN_CROSS_MODULE_EDGES_FOR_OVERVIEW=18
# GRAPH_V22_MODULE_FILTER_ORPHANS=false

# Frontend Graph V2.1 gate
# NEXT_PUBLIC_GRAPH_DENSE_MODE_V21=true
# Set to false for strict file-first fallback during rollback:
# NEXT_PUBLIC_GRAPH_DENSE_MODE_V21=false

# -----------------------
# Chat Hardening (Quality + Scalability)
# -----------------------
# CHAT_INTENT_ROUTING_ENABLED=true
# CHAT_CONTENT_RERANK_ENABLED=true
# CHAT_DOCS_FIRST_OVERVIEW_ENABLED=true
# CHAT_INTENT_LLM_TIEBREAK_ENABLED=true
# CHAT_EMIT_META_EVENT=true
# CHAT_HISTORY_MAX_MESSAGES=20
# CHAT_HISTORY_MAX_TOKENS=1800
# CHAT_CONTEXT_MAX_CHARS=18000
# CHAT_RETRIEVAL_CANDIDATE_LIMIT=24
# CHAT_RERANK_CANDIDATE_LIMIT=18
# CHAT_REQUEST_TIMEOUT_SECONDS=90
# CHAT_CONCURRENCY_WAIT_SECONDS=2.0
# CHAT_MAX_CONCURRENT_PER_REPO=4
# CHAT_REDIS_CACHE_ENABLED=false
# CHAT_RETRIEVAL_CACHE_TTL_SECONDS=600
# CHAT_ANSWER_CACHE_TTL_SECONDS=1800
# CHAT_EMBED_CACHE_TTL_SECONDS=3600

# Demo rate-limit backend
# RATE_LIMIT_REDIS_ENABLED=true
